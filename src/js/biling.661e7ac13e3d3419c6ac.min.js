(()=>{var e={4:()=>{null===localStorage.getItem("cart-storage")&&localStorage.setItem("cart-storage","[]"),null===localStorage.getItem("command-storage")&&localStorage.setItem("command-storage","[]")}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};r.r(e),r.d(e,{ConfigValidator:()=>l,DOMApi:()=>p,Global:()=>i,JSONManip:()=>d,LocalStorageAPI:()=>c,RequestFactory:()=>g});var t={};r.r(t),r.d(t,{Cart:()=>E,Command:()=>I,Product:()=>R});var a={};r.r(a),r.d(a,{CartError:()=>f,CommandError:()=>C});var n={};r.r(n),r.d(n,{CartCalculate:()=>x,CartSubmit:()=>S,CommandCalculate:()=>O});var o={};r.r(o),r.d(o,{AddArticle:()=>w,ChangeQuantity:()=>v,DeleteArticle:()=>A,GenerateCommand:()=>b,LoadPage:()=>N,SubmitCart:()=>P});const i={protocol:"https",hostname:"orinoco-back.herokuapp.com",typeData:"cameras",imgName:"vcam"},c=class{constructor(e){this.name=e}errorInit(){if(!this.isInitialized())throw{error:"INITIALIZATION_ERROR"}}errorEmpty(){if(this.errorInit(),this.isEmpty())throw{error:"EMPTY_ERROR"}}errorAccess(e){if(void 0===this.getArray(this.name).find((t=>t._id===e)))throw{error:"ACCESS_ERROR"}}isInitialized(){return null!==localStorage.getItem(this.name)}getArray(){return this.errorInit(),JSON.parse(localStorage.getItem(this.name))}isEmpty(){return this.errorInit(),0===JSON.parse(localStorage.getItem(this.name)).length}clearArray(){this.errorInit(),this.errorEmpty(),localStorage.setItem(this.name,"[]")}getById(e){return this.errorInit(),this.getArray(this.name).find((t=>t._id===e))}addItem(e){const t=this.getArray(this.name);t.push(e),localStorage.setItem(this.name,JSON.stringify(t))}setById(e,t){this.errorInit(),this.errorAccess(e);let r=this.getArray(name);for(let a=0;a<r.length;a++)r[a]._id===e&&(r[a]=t);localStorage.setItem(this.name,JSON.stringify(r))}removeItem(e){this.errorInit(),this.errorEmpty(),this.errorAccess(e);let t=this.getArray();t=t.filter((t=>t._id!==e)),localStorage.setItem(this.name,JSON.stringify(t))}},s=(()=>{let e={};const t={};return e.addRegex=(e,r)=>{t[e]=new RegExp(r)},e.checkRegex=e=>({valid:Object.entries(e).every((e=>{const r=e[0],a=e[1],n=t[r];let o;return o="object"==typeof a?a.every((e=>n.test(e))):n.test(a),o})),result:e}),e})();s.addRegex("name","^[a-zA-Z]{3,25}$"),s.addRegex("city","^[a-zA-Z]+(?:[s-][a-zA-Z]+)*$"),s.addRegex("address","^[0-9]{1,2}[a-zA-Z ]{2,45}$"),s.addRegex("email",/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/),s.addRegex("orderId","^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$"),s.addRegex("uuid","^[0-9a-z]{24}$"),s.addRegex("quantity","^[0-9]{1,2}$"),s.addRegex("price","^[0-9]{1,}00$");const l=s,d=(()=>{let e={stringifyJSON:t=>{if(null===t||"object"!=typeof t)return!1;Object.entries(t).map((([r,a])=>{"number"==typeof a&&(t[r]=a.toString()),e.stringifyJSON(a)}))},genericJSON:async t=>{let r;try{r=await t.json()}catch(e){throw{error:"ERROR_JSON"}}return e.stringifyJSON(r),r},formToJSON:(e,t)=>{const r=new FormData(e),a={};return t.map((e=>{const t=r.get(e);a[e]=t})),a}};return e})(),u=async(e,t,r,a)=>{let n;try{["GET","DELETE"].includes(t)&&(n=await fetch(e,{method:t,headers:r})),["POST","PUT","PATCH"].includes(t)&&(n=await fetch(e,{method:t,headers:r,body:JSON.stringify(a)}))}catch(e){throw console.log(e),{error:"NETWORK_ERROR"}}if(n.status>=400&&n.status<500)throw{error:"CLIENT_ERROR"};if(n.status>=500&&n.status<600)throw{error:"SERVER_ERROR"};return n};class m extends class{constructor(e,t){if(!["GET","DELETE"].includes(e))throw{error:"URLREQUEST_ERROR"};this.method=e,this.url=t}}{async send(e){let t,r=function(e,t){let r="?";return t?(Object.entries(t).map((([t,a])=>{const n=encodeURIComponent(a);e.includes(`{${t}}`)?e=e.replace(`{${t}}`,n):r+=`${t}=${n}&`})),r=r.slice(0,-1),e+=r):e}(this.url,e);return console.log(r),t=await u(r,this.method,{Accept:"application/json"},e),d.genericJSON(t)}}const y=(()=>{let e={},t={};return e.add=(e,r)=>{t[e]=r},e.get=e=>t[e],e})();y.add("submitCart",new class extends class{constructor(e,t){if(!["POST","PUT","PATCH"].includes(e))throw{error:"BODYREQUEST_ERROR"};this.method=e,this.url=t}}{async send(e){let t;return t=await u(this.url,this.method,{"Content-Type":"application/json"},e),d.genericJSON(t)}}("POST",`${i.protocol}://${i.hostname}/api/${i.typeData}/order`)),y.add("getProducts",new m("GET",`${i.protocol}://${i.hostname}/api/${i.typeData}`)),y.add("getProductById",new m("GET",`${i.protocol}://${i.hostname}/api/${i.typeData}/{id}`));const g=y,p={findParentNode:(e,t)=>{let r=e,a=r.classList.contains(t);for(;!a;)r=r.parentNode,a=r.classList.contains(t);return r}};r(4);const h=(()=>{let e={CartModel:null,RequestFactory:null,CartError:null,init:(t,r,a)=>{e.CartModel=t,e.RequestFactory=r,e.CartError=a},getEveryDependencies:()=>{const{CartModel:t,RequestFactory:r,CartError:a}=e;return{CartModel:t,RequestFactory:r,CartError:a}},listArticles:async()=>{const{CartError:t,CartModel:r}=e.getEveryDependencies();let a=r.getArray();return a.map((e=>t.errorFormat(e))),Promise.resolve(a)},clearCart:t=>{const{CartModel:r}=e.getEveryDependencies();r.clearArray()},addArticle:t=>{const{CartModel:r,CartError:a}=e.getEveryDependencies();a.errorFormat(t);const n=r.getById(t._id);return n?e.updateArticleWithNewQuantity(n,t):(e.updatePaidPrice(t),r.addItem(t)),r.getById(t._id)},removeArticle:t=>{const{CartModel:r,CartError:a}=e.getEveryDependencies();a.errorID(t);let n=r.getById(t);return r.removeItem(t),n},setArticleById:(t,r)=>{const{CartModel:a,CartError:n}=e.getEveryDependencies();return n.errorID(t),n.errorFormat(r),a.removeItem(t),e.addArticle(r),r},getArticleById:t=>{const{CartModel:r,CartError:a}=e.getEveryDependencies();return a.errorID(t),r.getById(t)},getEveryProductsId:async()=>{let e=await h.listArticles(),t=[];return e.map((e=>{const r=Number.parseInt(e.quantity),a=e._id;for(let e=0;e<r;e++)t.push(a)})),t},updatePaidPrice:e=>{const t=Number.parseInt(e.quantity,10)*Number.parseInt(e.price.slice(0,-2));e.calculatePrice=t.toString()},updateArticleWithNewQuantity:(t,r)=>{const{CartModel:a,CartError:n}=e.getEveryDependencies();let o=Number.parseInt(t.quantity)+Number.parseInt(r.quantity);o=o.toString(),r.quantity=o,e.updatePaidPrice(r);try{n.errorFormat(r)}catch(e){throw{error:"ADD_ERROR"}}a.setById(r._id,r)}};return e})(),E=h,R=(()=>{let e={},t=null,r=null,a=null;return e.init=(e,n,o)=>{t=e,r=n,a=o},e.fetchEvery=async()=>t.get("getProducts").send(),e.fetchById=async e=>{a.errorID(e);let r=t.get("getProductById").send({id:e});return r.price=r.price.toString(),r},e})(),I=(()=>{let e={},t=null,r=null;return e.init=(e,a)=>{t=e,r=a},e.getEveryDependencies=()=>({CommandModel:t,CommandError:r}),e.add=e=>{if(void 0===e)throw{error:"UNDEFINED_ERROR"};e._id=e.orderId,t.addItem(e)},e.get=e=>(r.errorUUID(e),t.getById(e)),e})(),f=(()=>{let e={},t=null,r=null;return e.init=(e,a)=>{t=e,r=a},e.errorFormat=e=>{if(!1===t.checkRegex({uuid:e._id,quantity:e.quantity,price:e.price}).valid)throw{error:"FORMAT_ERROR"}},e.errorSubmit=e=>{if(!t.checkRegex({name:[e.firstName,e.lastName],city:e.city,address:e.address,email:e.email}).valid)throw{error:"FORMAT_ERROR"}},e.errorProducts=e=>{const a=r.getArray();for(let e=0;e<a.length;e++){const r=a[e]._id;if(!t.checkRegex({uuid:r}).valid)throw{error:"FORMAT_ERROR"}}},e.errorID=e=>{if(!1===t.checkRegex({uuid:e}).valid)throw{error:"FORMAT_ERROR"}},e})(),C=(()=>{let e={},t=null;return e.init=e=>{t=e},e.errorUUID=e=>{if(!t.checkRegex({orderId:e}).valid)throw{error:"ERROR_FORMAT"}},e})(),x=(()=>{let e={},t=null;return e.init=e=>{t=e},e.totalPrices=e=>{const{CartModel:r,CartError:a}=t.getEveryDependencies(),n=r.getArray(),o=[];return n.map((e=>{a.errorFormat(e);const t=Number.parseInt(e.calculatePrice,10);o.push(t)})),0===n.length?0:o.reduce(((e,t)=>e+t))},e.quantities=e=>{const{CartModel:r,CartError:a}=t.getEveryDependencies(),n=r.getArray(),o=[];return 0===n.length?0:(n.map((e=>{a.errorFormat(e);const t=Number.parseInt(e.quantity);o.push(t)})),o.reduce(((e,t)=>e+t)))},e})(),S=(()=>{let e={},t=null;return e.init=e=>{t=e},e.submit=async e=>{const{CartError:r,RequestFactory:a,CartModel:n}=t.getEveryDependencies();r.errorSubmit(e),r.errorProducts();const o=await t.getEveryProductsId();let i=a.get("submitCart");return await i.send({contact:e,products:o})},e})(),O=(()=>{const e={};let t=null;return e.init=e=>{t=e},e.totalPrice=e=>t.get(e).products.map((e=>{const t=e.price;let r=t.slice(0,t.length-2);return Number.parseInt(r)})).reduce(((e,t)=>e+t)),e})(),w=(()=>{let e={},t=null,r=null;return e.init=(e,a)=>{t=e,r=a},e.run=async e=>{const a=t.addArticle(e);return{addedArticle:a,minQuantitySelected:1,maxQuantitySelected:99-a.quantity,totalProducts:r.quantities()}},e})(),v=(()=>{let e={},t=null,r=null;return e.init=(e,a)=>{t=e,r=a},e.cart=async e=>{if([e.id,e.quantity].includes(void 0))throw new{error:"UNDEFINED_ERROR"};const a=e.id;let n=e.quantity;const o=t.getArticleById(a);if(void 0===o)return{articleModified:void 0};o.quantity=n,t.setArticleById(a,o);const i=r.totalPrices();return n=r.quantities(),{updatedPrice:o.calculatePrice,totalPrice:i.toString(),quantity:n}},e.page=async e=>{if([e.price,e.quantity].includes(void 0))throw new{error:"UNDEFINED_ERROR"};let t=Number.parseInt(e.quantity);return Number.parseInt(e.price.slice(0,e.price.length-2))*t},e})(),A=(()=>{let e={},t=null,r=null;return e.init=(e,a)=>{t=e,r=a},e.run=async e=>({article:t.removeArticle(e),totalPrice:r.totalPrices(),quantity:r.quantities()}),e})(),N=(()=>{let e={},t=null,r=null,a=null;return e.init=(e,n,o)=>{t=n,a=e,r=o},e.run=async e=>{const n=await a.fetchEvery();let o=await t.listArticles();const i=n.map((e=>e._id));o.filter((e=>i.includes(e._id))).map((e=>{const r=e._id;let a=n.find((e=>e._id===r));a.quantity=e.quantity,t.setArticleById(r,a)}));const c=r.quantities(),s=n.find((t=>t._id===(null==e?void 0:e.id)));let l;l=null!=s&&s.quantity?99-Number.parseInt(null==s?void 0:s.quantity):99,o=await t.listArticles();const d=r.totalPrices();return{clientProducts:o,serverProducts:n,totalProducts:c,selectedProduct:s,minQuantitySelected:1,maxQuantitySelected:l,totalPrice:d}},e})(),P=(()=>{let e={},t=null,r=null,a=null;return e.init=(e,n,o)=>{t=e,r=n,a=o},e.run=async e=>{let n=await r.submit(e);return a.add(n),t.clearCart(),{result:n}},e})(),b=(()=>{let e={},t=null,r=null;return e.init=(e,a)=>{t=e,r=a},e.run=async e=>{const a=t.get(e).contact,{firstName:n,lastName:o,city:i,address:c,email:s}=a;return{firstName:n,lastName:o,city:i,address:c,email:s,totalPrice:r.totalPrice(e)}},e})();Object.entries(e).forEach((([e,t])=>window[e]=t)),Object.entries(t).forEach((([e,t])=>window[e]=t)),Object.entries(a).forEach((([e,t])=>window[e]=t)),Object.entries(n).forEach((([e,t])=>window[e]=t)),Object.entries(o).forEach((([e,t])=>window[e]=t));const q=(()=>{let e={data:[]};return e.firstName=document.querySelector("#firstname"),e.lastName=document.querySelector("#lastname"),e.city=document.querySelector("#city"),e.address=document.querySelector("#address"),e.price=document.querySelector("#price"),e.command=document.querySelector("#command"),e.drawInfo=(t,r)=>{document.title=`Orinoco - Commande - ${t}`,e.command.textContent=`Commande : ${t}`,e.firstName.textContent=r.firstName,e.lastName.textContent=r.lastName,e.city.textContent=r.city,e.address.textContent=r.address,e.price.textContent=`${r.totalPrice}€`},e})();(()=>{const e=window.location.search,t=new URLSearchParams(e).get("id");q.data.id=t})();const _=q,D=(()=>{let e={};return e.counterElement=document.querySelector(".l-header__counter"),e.place=[],e.drawQuantities=t=>{e.counterElement.style.display="none",t>0&&(e.counterElement.textContent=t,e.counterElement.style.display="flex")},e})();(()=>{for(let e=0;e<6;e++){const t=document.querySelector(`div[data-place="${e}"]`);D.place[e]=t}})(),(()=>{const e=new LocalStorageAPI("command-storage");CommandError.init(ConfigValidator),Command.init(e,CommandError),CommandCalculate.init(Command),GenerateCommand.init(Command,CommandCalculate)})();const T=_.data.id;document.addEventListener("DOMContentLoaded",(()=>{GenerateCommand.run(T).then((e=>{_.drawInfo(T,e)})).catch((e=>{alert(e.error)}))}))})()})();