(()=>{var t={4:()=>{null===localStorage.getItem("cart-storage")&&localStorage.setItem("cart-storage","[]"),null===localStorage.getItem("command-storage")&&localStorage.setItem("command-storage","[]")}},e={};function r(a){var n=e[a];if(void 0!==n)return n.exports;var o=e[a]={exports:{}};return t[a](o,o.exports,r),o.exports}r.d=(t,e)=>{for(var a in e)r.o(e,a)&&!r.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};r.r(t),r.d(t,{ConfigValidator:()=>s,DOMApi:()=>g,Global:()=>i,JSONManip:()=>d,LocalStorageAPI:()=>c,RequestFactory:()=>p});var e={};r.r(e),r.d(e,{Cart:()=>E,Command:()=>C,Product:()=>R});var a={};r.r(a),r.d(a,{CartError:()=>f,CommandError:()=>I});var n={};r.r(n),r.d(n,{CartCalculate:()=>P,CartSubmit:()=>x,CommandCalculate:()=>S});var o={};r.r(o),r.d(o,{AddArticle:()=>v,ChangeQuantity:()=>w,DeleteArticle:()=>A,GenerateCommand:()=>_,LoadPage:()=>O,SubmitCart:()=>b});const i={protocol:"https",hostname:"orinoco-back.herokuapp.com",typeData:"cameras",imgName:"vcam"},c=class{constructor(t){this.name=t}errorInit(){if(!this.isInitialized())throw{error:"INITIALIZATION_ERROR"}}errorEmpty(){if(this.errorInit(),this.isEmpty())throw{error:"EMPTY_ERROR"}}errorAccess(t){if(void 0===this.getArray(this.name).find((e=>e._id===t)))throw{error:"ACCESS_ERROR"}}isInitialized(){return null!==localStorage.getItem(this.name)}getArray(){return this.errorInit(),JSON.parse(localStorage.getItem(this.name))}isEmpty(){return this.errorInit(),0===JSON.parse(localStorage.getItem(this.name)).length}clearArray(){this.errorInit(),this.errorEmpty(),localStorage.setItem(this.name,"[]")}getById(t){return this.errorInit(),this.getArray(this.name).find((e=>e._id===t))}addItem(t){const e=this.getArray(this.name);e.push(t),localStorage.setItem(this.name,JSON.stringify(e))}setById(t,e){this.errorInit(),this.errorAccess(t);let r=this.getArray(name);for(let a=0;a<r.length;a++)r[a]._id===t&&(r[a]=e);localStorage.setItem(this.name,JSON.stringify(r))}removeItem(t){this.errorInit(),this.errorEmpty(),this.errorAccess(t);let e=this.getArray();e=e.filter((e=>e._id!==t)),localStorage.setItem(this.name,JSON.stringify(e))}},l=(()=>{let t={};const e={};return t.addRegex=(t,r)=>{e[t]=new RegExp(r)},t.checkRegex=t=>({valid:Object.entries(t).every((t=>{const r=t[0],a=t[1],n=e[r];let o;return o="object"==typeof a?a.every((t=>n.test(t))):n.test(a),o})),result:t}),t})();l.addRegex("name","^[a-zA-Z]{3,25}$"),l.addRegex("city","^[a-zA-Z]+(?:[s-][a-zA-Z]+)*$"),l.addRegex("address","^[0-9]{1,2}[a-zA-Z ]{2,45}$"),l.addRegex("email",/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/),l.addRegex("orderId","^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$"),l.addRegex("uuid","^[0-9a-z]{24}$"),l.addRegex("quantity","^[0-9]{1,2}$"),l.addRegex("price","^[0-9]{1,}00$");const s=l,d=(()=>{let t={stringifyJSON:e=>{if(null===e||"object"!=typeof e)return!1;Object.entries(e).map((([r,a])=>{"number"==typeof a&&(e[r]=a.toString()),t.stringifyJSON(a)}))},genericJSON:async e=>{let r;try{r=await e.json()}catch(t){throw{error:"ERROR_JSON"}}return t.stringifyJSON(r),r},formToJSON:(t,e)=>{const r=new FormData(t),a={};return e.map((t=>{const e=r.get(t);a[t]=e})),a}};return t})(),u=async(t,e,r,a)=>{let n;try{["GET","DELETE"].includes(e)&&(n=await fetch(t,{method:e,headers:r})),["POST","PUT","PATCH"].includes(e)&&(n=await fetch(t,{method:e,headers:r,body:JSON.stringify(a)}))}catch(t){throw console.log(t),{error:"NETWORK_ERROR"}}if(n.status>=400&&n.status<500)throw{error:"CLIENT_ERROR"};if(n.status>=500&&n.status<600)throw{error:"SERVER_ERROR"};return n};class m extends class{constructor(t,e){if(!["GET","DELETE"].includes(t))throw{error:"URLREQUEST_ERROR"};this.method=t,this.url=e}}{async send(t){let e,r=function(t,e){let r="?";return e?(Object.entries(e).map((([e,a])=>{const n=encodeURIComponent(a);t.includes(`{${e}}`)?t=t.replace(`{${e}}`,n):r+=`${e}=${n}&`})),r=r.slice(0,-1),t+=r):t}(this.url,t);return console.log(r),e=await u(r,this.method,{Accept:"application/json"},t),d.genericJSON(e)}}const y=(()=>{let t={},e={};return t.add=(t,r)=>{e[t]=r},t.get=t=>e[t],t})();y.add("submitCart",new class extends class{constructor(t,e){if(!["POST","PUT","PATCH"].includes(t))throw{error:"BODYREQUEST_ERROR"};this.method=t,this.url=e}}{async send(t){let e;return e=await u(this.url,this.method,{"Content-Type":"application/json"},t),d.genericJSON(e)}}("POST",`${i.protocol}://${i.hostname}/api/${i.typeData}/order`)),y.add("getProducts",new m("GET",`${i.protocol}://${i.hostname}/api/${i.typeData}`)),y.add("getProductById",new m("GET",`${i.protocol}://${i.hostname}/api/${i.typeData}/{id}`));const p=y,g={findParentNode:(t,e)=>{let r=t,a=r.classList.contains(e);for(;!a;)r=r.parentNode,a=r.classList.contains(e);return r}};r(4);const h=(()=>{let t={CartModel:null,RequestFactory:null,CartError:null,init:(e,r,a)=>{t.CartModel=e,t.RequestFactory=r,t.CartError=a},getEveryDependencies:()=>{const{CartModel:e,RequestFactory:r,CartError:a}=t;return{CartModel:e,RequestFactory:r,CartError:a}},listArticles:async()=>{const{CartError:e,CartModel:r}=t.getEveryDependencies();let a=r.getArray();return a.map((t=>e.errorFormat(t))),Promise.resolve(a)},clearCart:e=>{const{CartModel:r}=t.getEveryDependencies();r.clearArray()},addArticle:e=>{const{CartModel:r,CartError:a}=t.getEveryDependencies();a.errorFormat(e);const n=r.getById(e._id);return n?t.updateArticleWithNewQuantity(n,e):(t.updatePaidPrice(e),r.addItem(e)),r.getById(e._id)},removeArticle:e=>{const{CartModel:r,CartError:a}=t.getEveryDependencies();a.errorID(e);let n=r.getById(e);return r.removeItem(e),n},setArticleById:(e,r)=>{const{CartModel:a,CartError:n}=t.getEveryDependencies();return n.errorID(e),n.errorFormat(r),a.removeItem(e),t.addArticle(r),r},getArticleById:e=>{const{CartModel:r,CartError:a}=t.getEveryDependencies();return a.errorID(e),r.getById(e)},getEveryProductsId:async()=>{let t=await h.listArticles(),e=[];return t.map((t=>{const r=Number.parseInt(t.quantity),a=t._id;for(let t=0;t<r;t++)e.push(a)})),e},updatePaidPrice:t=>{const e=Number.parseInt(t.quantity,10)*Number.parseInt(t.price.slice(0,-2));t.calculatePrice=e.toString()},updateArticleWithNewQuantity:(e,r)=>{const{CartModel:a,CartError:n}=t.getEveryDependencies();let o=Number.parseInt(e.quantity)+Number.parseInt(r.quantity);o=o.toString(),r.quantity=o,t.updatePaidPrice(r);try{n.errorFormat(r)}catch(t){throw{error:"ADD_ERROR"}}a.setById(r._id,r)}};return t})(),E=h,R=(()=>{let t={},e=null,r=null,a=null;return t.init=(t,n,o)=>{e=t,r=n,a=o},t.fetchEvery=async()=>e.get("getProducts").send(),t.fetchById=async t=>{a.errorID(t);let r=e.get("getProductById").send({id:t});return r.price=r.price.toString(),r},t})(),C=(()=>{let t={},e=null,r=null;return t.init=(t,a)=>{e=t,r=a},t.getEveryDependencies=()=>({CommandModel:e,CommandError:r}),t.add=t=>{if(void 0===t)throw{error:"UNDEFINED_ERROR"};t._id=t.orderId,e.addItem(t)},t.get=t=>(r.errorUUID(t),e.getById(t)),t})(),f=(()=>{let t={},e=null,r=null;return t.init=(t,a)=>{e=t,r=a},t.errorFormat=t=>{if(!1===e.checkRegex({uuid:t._id,quantity:t.quantity,price:t.price}).valid)throw{error:"FORMAT_ERROR"}},t.errorSubmit=t=>{if(!e.checkRegex({name:[t.firstName,t.lastName],city:t.city,address:t.address,email:t.email}).valid)throw{error:"FORMAT_ERROR"}},t.errorProducts=t=>{const a=r.getArray();for(let t=0;t<a.length;t++){const r=a[t]._id;if(!e.checkRegex({uuid:r}).valid)throw{error:"FORMAT_ERROR"}}},t.errorID=t=>{if(!1===e.checkRegex({uuid:t}).valid)throw{error:"FORMAT_ERROR"}},t})(),I=(()=>{let t={},e=null;return t.init=t=>{e=t},t.errorUUID=t=>{if(!e.checkRegex({orderId:t}).valid)throw{error:"ERROR_FORMAT"}},t})(),P=(()=>{let t={},e=null;return t.init=t=>{e=t},t.totalPrices=t=>{const{CartModel:r,CartError:a}=e.getEveryDependencies(),n=r.getArray(),o=[];return n.map((t=>{a.errorFormat(t);const e=Number.parseInt(t.calculatePrice,10);o.push(e)})),0===n.length?0:o.reduce(((t,e)=>t+e))},t.quantities=t=>{const{CartModel:r,CartError:a}=e.getEveryDependencies(),n=r.getArray(),o=[];return 0===n.length?0:(n.map((t=>{a.errorFormat(t);const e=Number.parseInt(t.quantity);o.push(e)})),o.reduce(((t,e)=>t+e)))},t})(),x=(()=>{let t={},e=null;return t.init=t=>{e=t},t.submit=async t=>{const{CartError:r,RequestFactory:a,CartModel:n}=e.getEveryDependencies();r.errorSubmit(t),r.errorProducts();const o=await e.getEveryProductsId();let i=a.get("submitCart");return await i.send({contact:t,products:o})},t})(),S=(()=>{const t={};let e=null;return t.init=t=>{e=t},t.totalPrice=t=>e.get(t).products.map((t=>{const e=t.price;let r=e.slice(0,e.length-2);return Number.parseInt(r)})).reduce(((t,e)=>t+e)),t})(),v=(()=>{let t={},e=null,r=null;return t.init=(t,a)=>{e=t,r=a},t.run=async t=>{const a=e.addArticle(t);return{addedArticle:a,minQuantitySelected:1,maxQuantitySelected:99-a.quantity,totalProducts:r.quantities()}},t})(),w=(()=>{let t={},e=null,r=null;return t.init=(t,a)=>{e=t,r=a},t.cart=async t=>{if([t.id,t.quantity].includes(void 0))throw new{error:"UNDEFINED_ERROR"};const a=t.id;let n=t.quantity;const o=e.getArticleById(a);if(void 0===o)return{articleModified:void 0};o.quantity=n,e.setArticleById(a,o);const i=r.totalPrices();return n=r.quantities(),{updatedPrice:o.calculatePrice,totalPrice:i.toString(),quantity:n}},t.page=async t=>{if([t.price,t.quantity].includes(void 0))throw new{error:"UNDEFINED_ERROR"};let e=Number.parseInt(t.quantity);return Number.parseInt(t.price.slice(0,t.price.length-2))*e},t})(),A=(()=>{let t={},e=null,r=null;return t.init=(t,a)=>{e=t,r=a},t.run=async t=>({article:e.removeArticle(t),totalPrice:r.totalPrices(),quantity:r.quantities()}),t})(),O=(()=>{let t={},e=null,r=null,a=null;return t.init=(t,n,o)=>{e=n,a=t,r=o},t.run=async t=>{const n=await a.fetchEvery();let o=await e.listArticles();const i=n.map((t=>t._id));o.filter((t=>i.includes(t._id))).map((t=>{const r=t._id;let a=n.find((t=>t._id===r));a.quantity=t.quantity,e.setArticleById(r,a)}));const c=r.quantities(),l=n.find((e=>e._id===(null==t?void 0:t.id)));let s;s=null!=l&&l.quantity?99-Number.parseInt(null==l?void 0:l.quantity):99,o=await e.listArticles();const d=r.totalPrices();return{clientProducts:o,serverProducts:n,totalProducts:c,selectedProduct:l,minQuantitySelected:1,maxQuantitySelected:s,totalPrice:d}},t})(),b=(()=>{let t={},e=null,r=null,a=null;return t.init=(t,n,o)=>{e=t,r=n,a=o},t.run=async t=>{let n=await r.submit(t);return a.add(n),e.clearCart(),{result:n}},t})(),_=(()=>{let t={},e=null,r=null;return t.init=(t,a)=>{e=t,r=a},t.run=async t=>{const a=e.get(t).contact,{firstName:n,lastName:o,city:i,address:c,email:l}=a;return{firstName:n,lastName:o,city:i,address:c,email:l,totalPrice:r.totalPrice(t)}},t})();Object.entries(t).forEach((([t,e])=>window[t]=e)),Object.entries(e).forEach((([t,e])=>window[t]=e)),Object.entries(a).forEach((([t,e])=>window[t]=e)),Object.entries(n).forEach((([t,e])=>window[t]=e)),Object.entries(o).forEach((([t,e])=>window[t]=e));const q=(()=>{let t={data:{},place:{}};return t.selectQuantity=document.querySelector("#quantity"),t.selectLenses=document.querySelector("#lenses"),t.nameProduct=document.querySelector(".form__header h1"),t.priceProduct=document.querySelector(".form__header span"),t.descriptionProduct=document.querySelector(".form__description p"),t.totalPriceElement=document.querySelector(".form__price span"),t.productButton=document.querySelector(".form__button"),t.buttonLoader=document.querySelector(".btn__loader"),t.productContainer=document.querySelector(".l-product"),t.place.image=document.querySelector('div[data-place="image"]'),t.init=()=>{const e=window.location.search,r=new URLSearchParams(e).get("id");t.data.id=r},t.toggleLoader=()=>{const e=t.buttonLoader;e.classList.contains("active")?e.classList.remove("active"):e.classList.add("active")},t.drawQuantity=e=>{let r=t.selectQuantity;r.innerHTML="";for(let t=1;t<=e;t++){const e=document.createElement("option");e.setAttribute("value",t),e.textContent=t,r.appendChild(e)}r.classList.add("apparition")},t.drawLenses=e=>{let r=t.selectLenses;r.innerHTML="",e.forEach((t=>{const e=document.createElement("option");e.setAttribute("value",t),e.textContent=t,r.appendChild(e)})),r.classList.add("apparition")},t.generateImage=t=>{let e=document.createElement("img");return e.className="l-product__img apparition",e.setAttribute("src",t),e},t.drawText=e=>{let r=t.nameProduct,a=t.priceProduct,n=t.descriptionProduct;const o=e.name,i=`${e.price.slice(0,e.price.length-2)}€`,c=e.description;document.title=`Orinoco - Appareil Photo - ${o}`,r.classList.add("apparition"),a.classList.add("apparition"),n.classList.add("apparition"),r.textContent=o,a.textContent=i,n.textContent=c},t.drawTotalPrice=e=>{const r=`Prix total : ${e}€`;t.totalPriceElement.textContent=r},t})(),N=(()=>{let t={};return t.counterElement=document.querySelector(".l-header__counter"),t.place=[],t.drawQuantities=e=>{t.counterElement.style.display="none",e>0&&(t.counterElement.textContent=e,t.counterElement.style.display="flex")},t})();(()=>{for(let t=0;t<6;t++){const e=document.querySelector(`div[data-place="${t}"]`);N.place[t]=e}})();const D=N;(()=>{const t=new LocalStorageAPI("cart-storage");q.init(),CartError.init(ConfigValidator,t),Cart.init(t,RequestFactory,CartError),Product.init(RequestFactory,ConfigValidator,CartError),CartCalculate.init(Cart),LoadPage.init(Product,Cart,CartCalculate),AddArticle.init(Cart,CartCalculate),ChangeQuantity.init(Cart,CartCalculate)})(),document.addEventListener("DOMContentLoaded",(()=>{let t=q.data,{id:e}=t,{selectQuantity:r,productButton:a,counterElement:n,buttonLoader:o,place:i,productContainer:c}=q;LoadPage.run({id:e}).then((e=>{const{lenses:a,imageUrl:n,name:o}=e.selectedProduct,{maxQuantitySelected:l,totalProducts:s}=e,d=q.generateImage(n);t.selectedProduct=e.selectedProduct,c.replaceChild(d,i.image),q.drawQuantity(l),q.drawLenses(a),q.drawText(e.selectedProduct),D.drawQuantities(s),t.quantity=r.value})).catch((t=>{alert(t.error)})),r.addEventListener("change",(e=>{const r=e.target.value,a=t.selectedProduct.price;t.quantity=r,ChangeQuantity.page({quantity:r,price:a}).then((t=>{q.drawTotalPrice(t)})).catch((t=>{alert(t.error)}))})),a.addEventListener("click",(e=>{e.preventDefault();const r=t.quantity;t.selectedProduct.quantity=r,AddArticle.run(t.selectedProduct).then((e=>{q.drawQuantity(e.maxQuantitySelected);const r=e.totalProducts;t.quantity=1,D.drawQuantities(r)})).catch((t=>{alert(t.error)}))}))}))})()})();